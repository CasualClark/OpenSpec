# Task MCP HTTP Server - Production Environment Configuration
# This file contains production-ready settings with security and performance optimizations

# ========================================
# Server Configuration
# ========================================
NODE_ENV=production
PORT=8443
HOST=0.0.0.0

# ========================================
# TLS Configuration (HTTPS)
# ========================================
# Enable TLS for production environments
TLS_ENABLED=true
TLS_KEY=/etc/ssl/certs/task-mcp-server.key
TLS_CERT=/etc/ssl/certs/task-mcp-server.crt
TLS_CA=/etc/ssl/certs/ca-bundle.crt

# ========================================
# Authentication & Security
# ========================================
# Comma-separated list of valid bearer tokens
# Generate strong tokens for production use
AUTH_TOKENS=prod-token-1,prod-token-2,prod-token-3

# Enhanced security settings
SECURITY_HEADERS_ENABLED=true
STRICT_TRANSPORT_SECURITY=true
RATE_LIMIT_BURST=90
RATE_LIMIT_WINDOW_MS=60000

# ========================================
# CORS Configuration
# ========================================
# Comma-separated list of allowed origins
# Be specific in production for security
ALLOWED_ORIGINS=https://app.fission.ai,https://dashboard.fission.ai

# ========================================
# Rate Limiting
# ========================================
# Requests per minute per client
RATE_LIMIT=60

# Enable distributed rate limiting for multi-instance deployments
ENABLE_DISTRIBUTED_RATE_LIMIT=true
REDIS_URL=redis://redis:6379
REDIS_PASSWORD=${REDIS_PASSWORD}

# ========================================
# SSE Configuration
# ========================================
# Heartbeat interval in milliseconds (keep connections alive)
HEARTBEAT_MS=25000

# Connection limits
MAX_SSE_CONNECTIONS=1000
SSE_CONNECTION_TIMEOUT=300000

# ========================================
# Response Limits
# ========================================
# Maximum response size in KB
MAX_RESPONSE_SIZE_KB=1024

# Maximum request size in KB
MAX_REQUEST_SIZE_KB=512

# ========================================
# Logging Configuration
# ========================================
# Log level: error, warn, info, debug
LOG_LEVEL=info

# Enable structured JSON logging for production
LOG_FORMAT=json

# Audit logging
AUDIT_LOG_ENABLED=true
AUDIT_LOG_LEVEL=info
AUDIT_LOG_FILE=/var/log/task-mcp/audit.log

# Log rotation settings
LOG_MAX_SIZE=100m
LOG_MAX_FILES=10

# ========================================
# Performance Configuration
# ========================================
# Worker processes (0 = auto-detect CPU count)
WORKER_PROCESSES=0

# Connection limits
MAX_CONNECTIONS=10000
KEEPALIVE_TIMEOUT=65000
KEEPALIVE_REQUESTS=100

# Buffer sizes
CLIENT_BODY_BUFFER_SIZE=16k
CLIENT_HEADER_BUFFER_SIZE=1k
LARGE_CLIENT_HEADER_BUFFERS=4 8k

# ========================================
# Health Check Configuration
# ========================================
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_INTERVAL=30000
HEALTH_CHECK_TIMEOUT=5000
HEALTH_CHECK_GRACE_PERIOD=10000

# ========================================
# Metrics & Monitoring
# ========================================
METRICS_ENABLED=true
METRICS_PORT=9090
METRICS_PATH=/metrics

# Enable Prometheus metrics
PROMETHEUS_ENABLED=true

# ========================================
# Process Management
# ========================================
# PM2 configuration (if using PM2)
PM2_INSTANCES=max
PM2_MAX_MEMORY_RESTART=1G
PM2_RESTART_DELAY=4000

# Graceful shutdown timeout
GRACEFUL_SHUTDOWN_TIMEOUT=30000

# ========================================
# Content Security Policy
# ========================================
# CSP header for enhanced security
CSP_DEFAULT_SRC='self'
CSP_SCRIPT_SRC='self' 'unsafe-inline'
CSP_STYLE_SRC='self' 'unsafe-inline'
CSP_IMG_SRC='self' data: https:
CSP_CONNECT_SRC='self'
CSP_FONT_SRC='self'
CSP_OBJECT_SRC='none'
CSP_MEDIA_SRC='self'
CSP_FRAME_SRC='none'

# ========================================
# Working Directory
# ========================================
WORKING_DIRECTORY=/app

# ========================================
# Environment-Specific Settings
# ========================================
# Production database settings (if applicable)
DATABASE_URL=${DATABASE_URL}
DATABASE_POOL_SIZE=20

# External service URLs
EXTERNAL_API_URL=https://api.fission.ai
WEBHOOK_SECRET=${WEBHOOK_SECRET}

# Feature flags
FEATURE_ADVANCED_METRICS=true
FEATURE_REQUEST_TRACING=true
FEATURE_RESPONSE_CACHING=false

# ========================================
# Compliance & Audit
# ========================================
# Data retention settings
AUDIT_RETENTION_DAYS=90
METRICS_RETENTION_DAYS=30

# GDPR compliance settings
GDPR_ANONYMIZE_IPS=true
GDPR_DATA_RETENTION_DAYS=30

# ========================================
# Backup & Recovery
# ========================================
# Backup settings
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *
BACKUP_RETENTION_DAYS=30
BACKUP_S3_BUCKET=${BACKUP_S3_BUCKET}
BACKUP_S3_REGION=${BACKUP_S3_REGION}